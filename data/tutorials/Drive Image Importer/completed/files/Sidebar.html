<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 10px;
        font-size: 13px;
      }
      h3 {
        margin: 0 0 8px 0;
        font-size: 14px;
        font-weight: bold;
        text-align: center;
      }
      button {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        background: #4285f4;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      #status {
        margin-top: 8px;
        font-size: 12px;
        text-align: center;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 6px;
        margin-top: 10px;
      }
      .grid img {
        width: 100%;
        border-radius: 4px;
        cursor: pointer;
        display: block;
      }
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #4285f4;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-right: 4px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <h3>Drive Image Importer</h3>
    <button id="insertBtn" onclick="insertImages()">Insert Images in Sheet</button>
    <button id="importBtn" onclick="importImages()">Import Images in Sidebar</button>
    <div id="status"></div>
    <div id="grid" class="grid"></div>

    <script>
      function insertImages() {
        const btn = document.getElementById("insertBtn");
        const status = document.getElementById("status");
        btn.disabled = true;
        status.innerHTML = '<div class="spinner"></div>Inserting…';

        google.script.run
          .withSuccessHandler(() => {
            btn.disabled = false;
            status.innerHTML = "✅ Inserted into sheet.";
          })
          .withFailureHandler((err) => {
            btn.disabled = false;
            status.innerHTML = "❌ " + err.message;
          })
          .insertImages();
      }

      function importImages() {
        const btn = document.getElementById("importBtn");
        const grid = document.getElementById("grid");
        const status = document.getElementById("status");
        btn.disabled = true;
        grid.innerHTML = "";
        status.innerHTML = '<div class="spinner"></div>Loading images…';

        google.script.run
          .withSuccessHandler((images) => {
            btn.disabled = false;
            status.innerHTML = "";
            if (!images || images.length === 0) {
              status.innerHTML = "No images found.";
              return;
            }
            grid.innerHTML = images.map((img) => `<img src="${img.thumb}" alt="${img.name}" onclick="window.open('${img.url}', '_blank')">`).join("");
          })
          .withFailureHandler((err) => {
            btn.disabled = false;
            status.innerHTML = "❌ " + err.message;
          })
          .getImageList();
      }
    </script>
  </body>
</html>
